{"title":"02.React源码学习-component","date":"2019-11-26T08:23:29.000Z","date_formatted":{"ll":"2019年11月26日","L":"2019/11/26","MM-DD":"11-26"},"author":"zao","link":"2019/11/26/note/02-React源码学习-component","tags":["react源码"],"categories":["note"],"updated":"2019-11-26T08:23:29.000Z","content":"<h2 id=\"component\">Component<a href=\"#component\" title=\"Component\"></a></h2><p>React.js内是如何引用createElement:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;首先引入</span><br><span class=\"line\">import &#123;Component, PureComponent&#125; from &#39;.&#x2F;ReactBaseClasses&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;应用</span><br><span class=\"line\">const React &#x3D; &#123;</span><br><span class=\"line\">  &#x2F;&#x2F; ...other props</span><br><span class=\"line\">  Component,</span><br><span class=\"line\">  PureComponent,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">export default React;</span><br></pre></td></tr></table></figure>\n\n<p>Component代码在同级目录下 ReactBaseClasses.js 内：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function Component(props, context, updater) &#123;</span><br><span class=\"line\">  this.props &#x3D; props;</span><br><span class=\"line\">  this.context &#x3D; context;</span><br><span class=\"line\">  &#x2F;&#x2F; If a component has string refs, we will assign a different object later.</span><br><span class=\"line\">  this.refs &#x3D; emptyObject;</span><br><span class=\"line\">  &#x2F;&#x2F; We initialize the default updater but the real one gets injected by the</span><br><span class=\"line\">  &#x2F;&#x2F; renderer.</span><br><span class=\"line\">  this.updater &#x3D; updater || ReactNoopUpdateQueue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Component.prototype.forceUpdate &#x3D; function(callback) &#123;</span><br><span class=\"line\">  this.updater.enqueueForceUpdate(this, callback, &#39;forceUpdate&#39;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"发现一个不常见的api：\">发现一个不常见的api：<a href=\"#发现一个不常见的api：\" title=\"发现一个不常见的api：\"></a></h5><p><code>forceUpdate</code> ：强制刷新组件</p>\n<p>另<code>PureComponent</code>就比<code>Component</code>多了一个<code>isPureReactComponent</code>属性：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * Convenience component with default shallow equality check for sCU.</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function PureComponent(props, context, updater) &#123;</span><br><span class=\"line\">  this.props &#x3D; props;</span><br><span class=\"line\">  this.context &#x3D; context;</span><br><span class=\"line\">  &#x2F;&#x2F; If a component has string refs, we will assign a different object later.</span><br><span class=\"line\">  this.refs &#x3D; emptyObject;</span><br><span class=\"line\">  this.updater &#x3D; updater || ReactNoopUpdateQueue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const pureComponentPrototype &#x3D; (PureComponent.prototype &#x3D; new ComponentDummy());</span><br><span class=\"line\">pureComponentPrototype.constructor &#x3D; PureComponent;</span><br><span class=\"line\">&#x2F;&#x2F; Avoid an extra prototype jump for these methods.</span><br><span class=\"line\">Object.assign(pureComponentPrototype, Component.prototype);</span><br><span class=\"line\">pureComponentPrototype.isPureReactComponent &#x3D; true;</span><br><span class=\"line\"></span><br><span class=\"line\">export &#123;Component, PureComponent&#125;;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"03.React源码学习-FiberRoot与Fiber","link":"2019/11/27/note/03-React源码学习-FiberRoot与Fiber"},"next":{"title":"01.React源码学习-createElement","link":"2019/11/25/note/01-React源码学习-createElement"},"plink":"https://www.hansomezao.com/2019/11/26/note/02-React源码学习-component/","toc":[{"id":"component","title":"Component","index":"1"}]}