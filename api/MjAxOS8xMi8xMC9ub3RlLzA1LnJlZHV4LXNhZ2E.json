{"title":"05.redux-saga","date":"2019-12-10T05:39:02.000Z","date_formatted":{"ll":"2019å¹´12æœˆ10æ—¥","L":"2019/12/10","MM-DD":"12-10"},"author":"zao","link":"2019/12/10/note/05.redux-saga","tags":["react"],"categories":["note"],"updated":"2019-12-10T05:39:02.000Z","content":"<h2 id=\"redux-saga\">redux-saga<a href=\"#redux-saga\" title=\"redux-saga\"></a></h2><h3 id=\"ä»‹ç»ï¼š\">ä»‹ç»ï¼š<a href=\"#ä»‹ç»ï¼š\" title=\"ä»‹ç»ï¼š\"></a></h3><p>  åœ¨ redux-saga çš„ä¸–ç•Œé‡Œï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½é€šç”¨ yield Effects æ¥å®Œæˆï¼ˆEffect å¯ä»¥çœ‹ä½œæ˜¯ redux-saga çš„ä»»åŠ¡å•å…ƒï¼‰</p>\n<hr>\n<h3 id=\"åè¯é‡Šä¹‰ï¼š\">åè¯é‡Šä¹‰ï¼š<a href=\"#åè¯é‡Šä¹‰ï¼š\" title=\"åè¯é‡Šä¹‰ï¼š\"></a></h3><h4 id=\"effectï¼š\">Effectï¼š<a href=\"#effectï¼š\" title=\"Effectï¼š\"></a></h4><p>ä¸€ä¸ª effect å°±æ˜¯ä¸€ä¸ª Plain Object JavaScript å¯¹è±¡ï¼ŒåŒ…å«ä¸€äº›å°†è¢« saga middleware æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ä½¿ç”¨ redux-saga æä¾›çš„å·¥å‚å‡½æ•°æ¥åˆ›å»º effectã€‚ä¸€ä¸ª Saga æ‰€åšçš„å®é™…ä¸Šæ˜¯ç»„åˆé‚£äº›æ‰€æœ‰çš„ Effectï¼Œå…±åŒå®ç°æ‰€éœ€çš„æ§åˆ¶æµã€‚ æœ€ç®€å•çš„ä¾‹å­æ˜¯ç›´æ¥æŠŠ yield ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ”¾ç½®æ¥å¯¹åºåˆ—åŒ– yield Effectã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„æ§åˆ¶æµæ“ä½œç¬¦ï¼ˆif, while, forï¼‰ æ¥å®ç°æ›´å¤æ‚çš„æ§åˆ¶æµã€‚</p>\n<hr>\n<h3 id=\"æ ¸å¿ƒapi\">æ ¸å¿ƒAPI:<a href=\"#æ ¸å¿ƒapi\" title=\"æ ¸å¿ƒAPI:\"></a></h3><ul><li>Saga è¾…åŠ©å‡½æ•°:<ul><li>takeEvery<ul><li>å…è®¸å¤šä¸ªå®ä¾‹åŒæ—¶å¯åŠ¨</li>\n</ul></li>\n<li>takeLatest<ul><li>åœ¨ä»»ä½•æ—¶åˆ» takeLatest åªå…è®¸æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªä»»åŠ¡æ˜¯æœ€åè¢«å¯åŠ¨çš„é‚£ä¸ªï¼Œå¦‚æœä¹‹å‰å·²ç»æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œé‚£ä¹‹å‰çš„è¿™ä¸ªä»»åŠ¡ä¼šè‡ªåŠ¨è¢«å–æ¶ˆ</li>\n</ul></li>\n</ul></li>\n<li>Effect Creators<ul><li>take(pattern)<ul><li>takeå‡½æ•°å¯ä»¥ç†è§£ä¸ºç›‘å¬æœªæ¥çš„actionï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªå‘½ä»¤å¯¹è±¡ï¼Œå‘Šè¯‰middlewareç­‰å¾…ä¸€ä¸ªç‰¹å®šçš„actionï¼Œ Generatorä¼šæš‚åœï¼Œç›´åˆ°ä¸€ä¸ªä¸patternåŒ¹é…çš„actionè¢«å‘èµ·ï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œtakeæ˜¯ä¸€ä¸ªé˜»å¡çš„ effectã€‚take è®©æˆ‘ä»¬é€šè¿‡å…¨é¢æ§åˆ¶ action è§‚å¯Ÿè¿›ç¨‹æ¥æ„å»ºå¤æ‚çš„æ§åˆ¶æµæˆä¸ºå¯èƒ½ã€‚</li>\n</ul></li>\n<li>put(action)<ul><li>putå‡½æ•°æ˜¯ç”¨æ¥å‘é€actionçš„ effectï¼Œä½ å¯ä»¥ç®€å•çš„æŠŠå®ƒç†è§£æˆä¸ºreduxæ¡†æ¶ä¸­çš„dispatchå‡½æ•°ï¼Œå½“putä¸€ä¸ªactionåï¼Œreducerä¸­å°±ä¼šè®¡ç®—æ–°çš„stateå¹¶è¿”å›ï¼Œæ³¨æ„ï¼š put ä¹Ÿæ˜¯é˜»å¡ effect</li>\n</ul></li>\n<li>call(fn, â€¦args)<ul><li>callå‡½æ•°ä½ å¯ä»¥æŠŠå®ƒç®€å•çš„ç†è§£ä¸ºå°±æ˜¯å¯ä»¥è°ƒç”¨å…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼Œå®ƒå‘½ä»¤ middleware æ¥è°ƒç”¨fn å‡½æ•°ï¼Œ argsä¸ºå‡½æ•°çš„å‚æ•°ï¼Œæ³¨æ„ï¼š fn å‡½æ•°å¯ä»¥æ˜¯ä¸€ä¸ª Generator å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿”å› Promise çš„æ™®é€šå‡½æ•°ï¼Œcall å‡½æ•°ä¹Ÿæ˜¯é˜»å¡ effect</li>\n</ul></li>\n<li>select(selector, â€¦args)<ul><li>select å‡½æ•°æ˜¯ç”¨æ¥æŒ‡ç¤º middlewareè°ƒç”¨æä¾›çš„é€‰æ‹©å™¨è·å–Storeä¸Šçš„stateæ•°æ®ï¼Œä½ ä¹Ÿå¯ä»¥ç®€å•çš„æŠŠå®ƒç†è§£ä¸ºreduxæ¡†æ¶ä¸­è·å–storeä¸Šçš„ stateæ•°æ®ä¸€æ ·çš„åŠŸèƒ½ ï¼šstore.getState()</li>\n</ul></li>\n<li>fork(fn, â€¦args)<ul><li>fork å‡½æ•°å’Œ call å‡½æ•°å¾ˆåƒï¼Œéƒ½æ˜¯ç”¨æ¥è°ƒç”¨å…¶ä»–å‡½æ•°çš„ï¼Œä½†æ˜¯forkå‡½æ•°æ˜¯éé˜»å¡å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºæ‰§è¡Œå®Œ yield fork(fnï¼Œ args) è¿™ä¸€è¡Œä»£ç åï¼Œä¼šç«‹å³æ¥ç€æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç è¯­å¥ï¼Œè€Œä¸ä¼šç­‰å¾…fnå‡½æ•°è¿”å›ç»“æœåï¼Œåœ¨æ‰§è¡Œä¸‹é¢çš„è¯­å¥</li>\n</ul></li>\n<li>cancel(task)<ul><li>ä¸€æ—¦ä»»åŠ¡è¢« forkï¼Œå¯ä»¥ä½¿ç”¨ yield cancel(task) æ¥ä¸­æ­¢ä»»åŠ¡æ‰§è¡Œï¼Œä½¿ç”¨ yield cancelled() æ¥æ£€æŸ¥ Generator æ˜¯å¦å·²ç»è¢«å–æ¶ˆã€‚å–æ¶ˆæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚å–æ¶ˆæ¥å£è¯·æ±‚ï¼ˆraceä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼å–æ¶ˆåŠŸèƒ½ï¼‰</li>\n</ul></li>\n</ul></li>\n<li>createSagaMiddleware()<ul><li>createSagaMiddleware å‡½æ•°æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ª Redux ä¸­é—´ä»¶ï¼Œå°† Sagas ä¸ Redux Store é“¾æ¥èµ·æ¥ã€‚sagas ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½å¿…é¡»è¿”å›ä¸€ä¸ª Generator å¯¹è±¡ï¼Œmiddleware ä¼šè¿­ä»£è¿™ä¸ª Generator å¹¶æ‰§è¡Œæ‰€æœ‰ yield åçš„ Effectï¼ˆEffect å¯ä»¥çœ‹ä½œæ˜¯ redux-saga çš„ä»»åŠ¡å•å…ƒï¼‰</li>\n</ul></li>\n<li>middleware.run(sagas, â€¦args)<ul><li>åŠ¨æ€æ‰§è¡Œsagasï¼Œç”¨äºapplyMiddlewareé˜¶æ®µä¹‹åæ‰§è¡Œsagas</li>\n</ul></li>\n</ul><hr>\n<h3 id=\"é”™è¯¯å¤„ç†ï¼š\">é”™è¯¯å¤„ç†ï¼š<a href=\"#é”™è¯¯å¤„ç†ï¼š\" title=\"é”™è¯¯å¤„ç†ï¼š\"></a></h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ try/catch è¯­æ³•åœ¨ Saga ä¸­æ•è·é”™è¯¯ã€‚</p>\n<hr>\n<h3 id=\"ç¤ºä¾‹é¡¹ç›®\">ç¤ºä¾‹é¡¹ç›®:<a href=\"#ç¤ºä¾‹é¡¹ç›®\" title=\"ç¤ºä¾‹é¡¹ç›®:\"></a></h3><ul><li>ğŸ’¯<a href=\"https://github.com/TigerHee/tiger-react-cli\" target=\"_blank\">tiger-react-cli</a></li>\n</ul>","prev":{"title":"03.Hook","link":"2019/12/10/note/03.Hook"},"next":{"title":"04.redux","link":"2019/12/10/note/04.redux"},"plink":"https://www.hansomezao.com/2019/12/10/note/05.redux-saga/","toc":[{"id":"redux-saga","title":"redux-saga","index":"1","children":[{"id":"ä»‹ç»ï¼š","title":"ä»‹ç»ï¼š","index":"1.1"},{"id":"åè¯é‡Šä¹‰ï¼š","title":"åè¯é‡Šä¹‰ï¼š","index":"1.2"},{"id":"æ ¸å¿ƒapi","title":"æ ¸å¿ƒAPI:","index":"1.3"},{"id":"é”™è¯¯å¤„ç†ï¼š","title":"é”™è¯¯å¤„ç†ï¼š","index":"1.4"},{"id":"ç¤ºä¾‹é¡¹ç›®","title":"ç¤ºä¾‹é¡¹ç›®:","index":"1.5"}]}]}